(this["webpackJsonpaiff-explorer"]=this["webpackJsonpaiff-explorer"]||[]).push([[0],{10:function(e,t,n){(function(t){const s=n(23),a=n(24),i=a.BufferStruct,r=(a.BufferStructUnion,a.BufferStructBase);const c=new class extends r{constructor(){super({name:"PString"})}parse(e,t,n=null){const s=e.readUInt8(t),a=e.slice(t+1,t+1+s).toString("utf8"),i=(r=1+s,c=2,Math.ceil(r/c)*c);var r,c;return this.lastOffset=t+i,a}serialize(e,n=null){if(!e)throw new Error("missing argument 'data' when serializing ".concat(this.getName()));const s=[t.from([e.length]),t.from(e)];return(1+e.length)%2===1&&s.push(t.alloc(1)),t.concat(s)}},o=new i({name:"AIFFChunk",endian:"big",fields:{ckID:{type:"utf8",size:4},ckSize:{type:"int",size:4},chunkData:{type:"bytes",align:2,size:e=>e.ckSize}}}),l=new i({name:"AIFFCommon",endian:"big",fields:{numChannels:{type:"int",size:2},numSampleFrames:{type:"uint",size:4},sampleSize:{type:"int",size:2},sampleRate:{type:"bytes",size:10}}}),u=new i({name:"AIFCCommon",endian:"big",fields:{numChannels:{type:"int",size:2},numSampleFrames:{type:"uint",size:4},sampleSize:{type:"int",size:2},sampleRate:{type:"bytes",size:10},compressionType:{type:"utf8",size:4},compressionName:{type:c}}}),f=new i({name:"AIFCApplicationSpecific",endian:"big",fields:{applicationSignature:{type:"utf8",size:4},data:{type:"bytes",size:(e,t)=>t.dataSize}}}),p=new i({name:"AIFFSoundData",endian:"big",fields:{offset:{type:"uint",size:4},blockSize:{type:"uint",size:4},soundData:{type:"bytes",size:(e,t)=>t.soundDataSize}}}),h={type:"int",size:2},m=new i({name:"AIFFMarker",endian:"big",fields:{id:h,position:{type:"uint",size:4},markerName:{type:c}}}),d=new i({name:"AIFFComment",endian:"big",fields:{timeStamp:{type:"uint",size:4},marker:h,count:{type:"uint",size:2},text:{type:"utf8",size:e=>e.count}}}),z=new i({name:"AIFFLoop",endian:"big",fields:{playMode:{type:"int",size:2},beginLoop:h,endLoop:h}}),g=new i({name:"AIFFInstrument",endian:"big",fields:{baseNote:{type:"int",size:1},detune:{type:"int",size:1},lowNote:{type:"int",size:1},highNote:{type:"int",size:1},lowVelocity:{type:"int",size:1},highVelocity:{type:"int",size:1},gain:{type:"int",size:2},sustainLoop:{type:z},releaseLoop:{type:z}}}),b=new i({name:"AIFFText",endian:"big",fields:{text:{type:"utf8",size:(e,t)=>t.dataSize}}}),y=new i({name:"AIFCFormat",endian:"big",fields:{timestamp:{type:"uint",size:4}}});function k(e,t){return o.serialize({ckID:e,ckSize:t.length,chunkData:t})}e.exports={serialize:function({soundData:e,numChannels:n,sampleRate:a,sampleSize:i,form:r,compressionType:c,compressionName:o,appl:h}){const m=Math.floor(e.length/n/(i/8)),d=t.from(s.ConvertToIeeeExtended(a));console.log({sampleRate:a,sampleRate80Bit:d});const z="AIFC"===r?k("FVER",y.serialize({timestamp:2726318400})):null,g=k("COMM","AIFC"===r?u.serialize({numChannels:n,numSampleFrames:m,sampleSize:i,sampleRate:d,compressionType:c,compressionName:o}):l.serialize({numChannels:n,numSampleFrames:m,sampleSize:i,sampleRate:d})),b=k("SSND",t.concat([p.serialize({offset:0,blockSize:0,soundData:e},{soundDataSize:e.length})])),S="AIFC"===r&&h?h.map((e=>k("APPL",t.concat([f.serialize(e,{dataSize:e.data.length})])))):[],w=t.from("AIFC"===r?"AIFC":"AIFF","utf8");return k("FORM",t.concat([w,z,g,b,...S].filter(Boolean)))},parse:function(e){let t=0,n={};const a=[];for(;t<e.length;){console.error("parsing file chunk",e.slice(t,t+4).toString("utf8"),"at",t,{fileContents:e});const n=o.parse(e,t);n.startOffset=t,n.endOffset=o.lastOffset,a.push(n),t=o.lastOffset}console.log(a);const i=a.filter((e=>"FORM"===e.ckID));return i.forEach((e=>{let t=0;console.log("FORM chunk",e),e.form=e.chunkData.slice(0,4).toString("utf8"),n.form=e.form,t+=4,console.log({formID:e.form});const a=[];for(;t<e.chunkData.length;){console.error("parsing FORM local chunk",e.chunkData.slice(t,t+4),"at",t);const i=o.parse(e.chunkData,t);switch(i.startOffset=t,i.endOffset=o.lastOffset,0===i.ckSize&&console.error("zero size chunk",e.chunkData.slice(t,t+64)),i.ckID){case"COMM":i.comm="AIFC"===e.form?u.parse(i.chunkData):l.parse(i.chunkData),i.comm.sampleRate=s.ConvertFromIeeeExtended(i.comm.sampleRate),n.sampleRate=i.comm.sampleRate,n.sampleSize=i.comm.sampleSize,n.numChannels=i.comm.numChannels,n.compressionType=i.comm.compressionType,n.compressionName=i.comm.compressionName;break;case"SSND":i.ssnd=p.parse(i.chunkData,0,{soundDataSize:i.ckSize-8}),n.soundData=i.ssnd.soundData;break;case"MARK":i.mark=m.parse(i.chunkData,0);break;case"COMT":i.comt=d.parse(i.chunkData,0);break;case"INST":i.inst=g.parse(i.chunkData,0);break;case"NAME":case"AUTH":case"(c) ":case"ANNO":i[i.ckID.toLowerCase()]=b.parse(i.chunkData,0,{dataSize:i.ckSize});break;case"APPL":i.appl=f.parse(i.chunkData,0,{dataSize:i.ckSize-4}),n.appl=n.appl||[],n.appl.push(i.appl);break;case"AIFC":i.format=y.parse(i.chunkData);break;case"FVER":i.fver=y.parse(i.chunkData);break;default:console.error("unknown chunk type",i.ckID)}console.log("local chunk",i),a.push(i),t=o.lastOffset}e.localChunks=a})),n.fileChunks=a,n.formChunks=i,n},PString:c}}).call(this,n(4).Buffer)},11:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n(1),i=n(7),r=n.n(i),c=n(8);const o=document.getElementById("root");r.a.render(Object(s.jsx)(a.StrictMode,{children:Object(s.jsx)(c.a,{})}),o)},22:function(e,t,n){},23:function(e,t){const n=(e,t)=>e*Math.pow(2,t);const s=e=>e-2147483648+2147483647+1;const a=e=>(e-2147483647|0)-1+2147483648;e.exports={ConvertFromIeeeExtended:function(e){let t,s,i,r;return s=(127&e[0])<<8|255&e[1],i=(255&e[2])<<24|(255&e[3])<<16|(255&e[4])<<8|255&e[5],r=(255&e[6])<<24|(255&e[7])<<16|(255&e[8])<<8|255&e[9],0==s&&0==i&&0==r?t=0:32767==s?t=1/0:(s-=16383,t=n(a(i),s-=31),t+=n(a(r),s-=32)),128&e[0]?-t:t},ConvertToIeeeExtended:function(e){let t,a,i,r,c,o,l=new Array(10).fill(0);if(e<0?(t=32768,e*=-1):t=0,0==e)a=0,c=0,o=0;else{const l=function(e){const t=[e=Number(e),0];if(0!==e&&Number.isFinite(e)){const n=Math.abs(e),s=Math.log2||function(e){return Math.log(e)*Math.LOG2E};let a=Math.max(-1023,Math.floor(s(n))+1),i=n*Math.pow(2,-a);for(;i<.5;)i*=2,a--;for(;i>=1;)i*=.5,a++;e<0&&(i=-i),t[0]=i,t[1]=a}return t}(e);i=l[0],a=l[1],a>16384||!(i<1)?(a=32767|t,c=0,o=0):(a+=16382,a<0&&(i=n(i,a),a=0),a|=t,i=n(i,32),r=Math.floor(i),c=s(r),i=n(i-r,32),r=Math.floor(i),o=s(r))}return l[0]=a>>8,l[1]=a,l[2]=c>>24,l[3]=c>>16,l[4]=c>>8,l[5]=c,l[6]=o>>24,l[7]=o>>16,l[8]=o>>8,l[9]=o,l}}},24:function(e,t,n){(function(t){function n(e,t){if(null==e)throw new Error("unexpected null"+(t?": "+t:""));return e}function s(e,t){if(isNaN(e))throw new Error("unexpected NaN"+(t?": "+t:""));return e}const a={uint:"UInt",int:"Int",float:"Float",double:"Double",bigint:"BigInt",biguint:"BigUint",char:"UInt"},i=new Set(["bytes","utf8"]);function r(e,t,n){return"".concat(a[e]).concat(8*t).concat(1==t?"":"big"==n?"BE":"LE")}function c(e,t){return Math.ceil(e/t)*t}function o(e,t){return null!=e.align?c(s(t),s(e.align)):s(t)}class l{constructor(e){this.schema=e,this.lastOffset=0}parse(e,t,n=null){}serialize(e,t=null){}getStaticSize(){throw new Error("getStaticSize not implemented on: "+this.constructor.name)}getName(){return this.schema.name||this.constructor.name}}class u{constructor({members:e,selectMember:t}){this.selectMember=t,this.members=e,this.size=Math.max(...e.map((e=>e.getStaticSize())))}}e.exports={BufferStruct:class extends l{constructor(...e){super(...e),this._staticSize=null}parse(e,t,n=null){const a={};let c=t||0;if(Object.keys(this.schema.fields).forEach((t=>{const u=this._getFieldConfig(t,a,n),f=u.field,p=u.endian,h=u.size,m=u.type,d=i.has(m)?(e,n)=>{if(null==h)throw new Error("can't parse field of type 'bytes' without predetermined size");if(e.length<n+h)throw new Error("tried to read ".concat(h," bytes but only ").concat(e.length-n," remaining for field ").concat(t," on ").concat(this.getName()));const s=e.slice(n,n+h);let a=s;return"utf8"===m&&(a=s.toString("utf8")),{value:a,parsedSize:h}}:m instanceof l?(e,t)=>({value:m.parse(e,t,n),parsedSize:null!=h?h:m.lastOffset-t}):(e,n)=>{const s="read".concat(r(m,h,p)),a=e[s](n);return this.schema.traceReads&&console.log(s,{fieldName:t,type:m,size:h,endian:p,startOffset:n,value:a}),{value:a,parsedSize:h}},z=(e,n)=>{const a=d(e,s(n)),i=a.value,r=a.parsedSize;if(null!=h&&r>h)throw new Error("parsed size ".concat(r," larger than predetermined size ").concat(h," for field ").concat(t," on ").concat(this.getName()));let c=o(f,null!=h?h:r);if(null!=h){const e=o(f,h);if(c>e)throw new Error("aligned parsed size ".concat(c," larger than aligned predetermined size ").concat(e," for field ").concat(t," on ").concat(this.getName()))}return{value:i,consumedSize:s(c)}};if(f.arrayElements){const i="function"===typeof f.arrayElements?f.arrayElements(a,n):f.arrayElements,r=new Array(i);for(var g=0;g<i;++g){const t=z(e,c),n=t.value,a=t.consumedSize;c+=s(a),r[g]=n}a[t]=r}else{const n=z(e,c),i=n.value,r=n.consumedSize;c+=s(r),a[t]=i}})),isNaN(c))throw new Error("invalid offset while parsing ".concat(this.getName()));return this.lastOffset=c,a}_getFieldConfig(e,t,s){const r=n(this.schema.fields[e],"".concat(e," schema is missing")),c=r.endian||this.schema.endian||"little",o=n(r.type,"".concat(e," type"));if(!(o instanceof l||o instanceof u||o in a||i.has(o)))throw new Error("unsupported type ".concat(o," in ").concat(e));let f="function"===typeof r.size?r.size(t,s):r.size;i.has(o)||o instanceof l||(f=o instanceof u?o.size:n(f,"".concat(e," size")));let p=o;if(o instanceof u&&(p=o.selectMember(t,s),null==p))throw new Error("failed to refine union type in field ".concat(e," on ").concat(this.getName()));return{field:r,endian:c,size:f,type:p}}serialize(e,n=null){if(!e)throw new Error("missing argument 'data' when serializing ".concat(this.getName()));const s=[];return Object.keys(this.schema.fields).forEach((a=>{const o=this._getFieldConfig(a,e,n),u=o.field,f=o.endian,p=o.size,h=o.type;let m;if(!(a in e)){if(!("default"in u))throw new Error("missing field ".concat(a," when serializing ").concat(this.getName()));m=u.default}m=e[a];const d=i.has(h)?e=>{let n=e;"utf8"===h&&(n=t.from(e,"utf8"));const s=null==p?n.length:p,a=t.alloc(s);return n.copy(a,0,0,s),a}:h instanceof l?e=>h.serialize(e,n):e=>{const n="write".concat(r(h,p,f)),s=t.alloc(p);return s[n](e),this.schema.traceWrites&&console.log(n,{fieldName:a,type:h,size:p,endian:f,value:e}),s},z=e=>{const n=d(e),s=n.length;if(null!=p&&s>p)throw new Error("serialized size ".concat(s," larger than predetermined size ").concat(p," for field ").concat(a," on ").concat(this.getName()));let i=n;if(null!=u.align){const e=c(s,u.align),r=c(p,u.align);if(e>r)throw new Error("serialized aligned size ".concat(i.length," larger than predetermined size (aligned) ").concat(r," for field ").concat(a," on ").concat(this.getName()));const o=t.alloc(e);n.copy(o),i=o}return i};if(u.arrayElements)for(var g=0;g<m.length;++g){const e=z(m[g]);s.push(e)}else{const e=z(m);s.push(e)}})),t.concat(s)}getStaticSize(){const e=this._staticSize;if(null!=e)return e;{let e=0;for(var t=0,n=Object.values(this.schema.fields);t<n.length;t++){const s=n[t];if("number"!=typeof s.size)throw new Error("cannot get static size of struct: "+this.getName());e+=o(s,s.size)}return this._staticSize=e,e}}},BufferStructBase:l,BufferStructUnion:u}}).call(this,n(4).Buffer)},8:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return z}));var s=n(5),a=n.n(s),i=n(9),r=n(6),c=n(0),o=n(2),l=(n(22),n(10)),u=n(1);function f(e){return new Promise(((t,n)=>{const s=new FileReader;s.readAsArrayBuffer(e),s.addEventListener("load",(()=>{t(s.result)})),s.addEventListener("error",(()=>{n(s.error)}))}))}const p={border:"solid 1px black"},h={margin:"8px 8px",wordWrap:"break-word"};function m({object:e}){return Object(c.jsx)("div",{style:Object(o.a)(Object(o.a)({},p),{},{margin:"8px 0px"}),children:Object.keys(e).map((t=>e[t]&&"object"===typeof e[t]?"number"===typeof e[t].length?Object(c.jsxs)("div",{style:h,children:[t,":"," ","number"===typeof e[t].length?"Buffer {size: ".concat(e[t].length,"}"):Object(c.jsx)(m,{object:e[t]})]},t):Object(c.jsxs)("div",{style:h,children:[t,": ",Object(c.jsx)(m,{object:e[t]})]},t):Object(c.jsxs)("div",{style:h,children:[t,": ",JSON.stringify(e[t])]},t)))})}function d({chunk:e}){const t=e.ckID,n=e.ckSize,s=e.localChunks,a=e[t.toLowerCase()];return Object(c.jsxs)("div",{style:Object(o.a)(Object(o.a)({},p),{},{margin:"8px 0px"}),children:[Object(c.jsxs)("div",{style:h,children:["chunk ID: ",t]}),Object(c.jsxs)("div",{style:h,children:["chunk size: ",n]}),a&&Object(c.jsxs)("div",{style:h,children:[t," chunk contents:"," ","object"===typeof a?Object(c.jsx)(m,{object:a}):JSON.stringify(a)]}),s&&Object(c.jsxs)("div",{style:h,children:["local chunks:",s.map(((e,t)=>Object(c.jsx)(d,{chunk:e},t)))]}),Object(c.jsxs)("div",{style:Object(o.a)(Object(o.a)({},h),{},{fontSize:"0.8em",color:"#777"}),children:["end ",t," chunk"]})]})}function z(){const t=Object(u.useState)(null),n=Object(r.a)(t,2),s=n[0],o=n[1],p=Object(u.useState)(null),h=Object(r.a)(p,2),m=h[0],z=h[1],g=Object(u.useCallback)(function(){var t=Object(i.a)(a.a.mark((function t(n){var s,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n.currentTarget.files,t.next=3,f(s[0]);case 3:i=t.sent;try{o(l.parse(new e(i)))}catch(a){z(a)}case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[]);return Object(c.jsxs)("div",{className:"App",children:[Object(c.jsx)("h1",{children:"AIFF explorer"}),Object(c.jsxs)("div",{children:[Object(c.jsx)("p",{children:"This tool visualizes the chunks in an AIFF file."}),Object(c.jsx)("input",{type:"file",id:"input",onChange:g})]}),m&&Object(c.jsx)("pre",{children:m.toString()+"\n"+m.stack}),s&&s.fileChunks.map(((e,t)=>Object(c.jsx)(d,{chunk:e},t)))]})}}).call(this,n(4).Buffer)}},[[11,1,2]]]);
//# sourceMappingURL=main.f79f31eb.chunk.js.map